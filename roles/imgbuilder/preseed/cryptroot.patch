269a270
> 		cryptkeyaskpass="Unlocking the disk $cryptsource ($crypttarget)\nEnter passphrase: "
271c272,273
< 			cryptkey="Unlocking the disk $cryptsource ($crypttarget)\nEnter passphrase: "
---
> 			cryptkey="$(printf "$cryptkeyaskpass")"
> 			cryptkeyaskpass=""
274,276d275
< 				cryptkey=$(printf "$cryptkey")
< 			else
< 				cryptkeyscript="/lib/cryptsetup/askpass"
279a279,284
> 		if [ -n "$cryptkeyscript" ] ; then
> 			mkfifo -m 0600 /lib/cryptsetup/passfifo
> 			( ( res=`crypttarget="$crypttarget" cryptsource="$cryptsource" \
> 				$cryptkeyscript "$cryptkey"` ;\
> 				echo -ne "${res}" > /lib/cryptsetup/passfifo ) & )
> 		fi
