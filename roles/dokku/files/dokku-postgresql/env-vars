#!/usr/bin/env bash

source "$(dirname $0)/vars"

verify_app_name "$1"

DB_LINKS="$DB_APP_DATABASES$APP/"

cat

[[ ! -d "$DB_LINKS" ]] || ls -1 "$DB_LINKS" | while read DB_NAME; do
	if db_info "$APP" "$DB_NAME"; then
		echo "DATABASE_URL=$DB_URL"
		if test -n $DOKKU_VERBOSE_DATABASE_ENV; then
			x='s/([^:]+):\/\/([^:]+):([^@]+)@([^:]+):([0-9]+)\/(.+)/'
			echo "DATABASE_NAME=`echo $DB_URL | sed -re \"$x\6/\"`"
			echo "DATABASE_USERNAME=`echo $DB_URL | sed -re \"$x\2/\"`"
			echo "DATABASE_PASSWORD=`echo $DB_URL | sed -re \"$x\3/\"`"
			echo "DB_NAME=`echo $DB_URL | sed -re \"$x\6/\"`"
			echo "DB_USER=`echo $DB_URL | sed -re \"$x\2/\"`"
			echo "DB_PASS=`echo $DB_URL | sed -re \"$x\3/\"`"
		fi
	fi
done
